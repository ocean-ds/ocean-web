$arrow-directions: (
  down: top,
  up: bottom,
  left: right,
  right: left,
);

@mixin arrow($direction) {
  @if not map-has-key($arrow-directions, $direction) {
    @error '[tooltip] The $direction parameter must be one of: `#{map-keys($DIRECTIONS)}, `#{$direction}` was given.';
  }
  border: 5px solid transparent;
  height: 0;
  width: 0;
  border-#{map-get($arrow-directions, $direction)}-color: $color-interface-dark-deep;
}

@mixin base-effects() {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.18s ease-out 0.18s, transform 0.18s ease-out 0.18s;
}

@mixin no-effects() {
  transition: none;
}

@mixin normalized-text() {
  font-size: $font-size-xxxs;
  font-style: normal;
  font-weight: $font-weight-regular;
  text-indent: 0;
  text-shadow: none;
}

// Tooltip with close button (wrapper approach)
.ods-tooltip-wrapper {
  display: inline-block;
  position: relative;

  // Show tooltip and arrow on hover
  &:hover {
    .ods-tooltip-content,
    .ods-tooltip-arrow {
      opacity: 1;
      pointer-events: auto;
    }
  }

  // Arrow visibility controlled by wrapper position classes
  &--up,
  &--down {
    .ods-tooltip-arrow {
      left: 50%;
      transform: translateX(-50%);
    }
  }

  &--up-left,
  &--down-left {
    .ods-tooltip-arrow {
      left: $spacing-inline-xs;
    }
  }

  &--up-right,
  &--down-right {
    .ods-tooltip-arrow {
      right: $spacing-inline-xs;
    }
  }

  &--left,
  &--right {
    .ods-tooltip-arrow {
      top: 50%;
      transform: translateY(-50%);
    }
  }

  &--left-top,
  &--right-top {
    .ods-tooltip-arrow {
      top: $spacing-inline-xxs-extra;
    }
  }

  &--left-bottom,
  &--right-bottom {
    .ods-tooltip-arrow {
      bottom: $spacing-inline-xxs-extra;
    }
  }
}

// Separate arrow element positioned relative to wrapper (trigger)
.ods-tooltip-arrow {
  @include base-effects();

  position: absolute;
  z-index: 11;

  &--visible {
    opacity: 1;
    pointer-events: none;
  }

  &--blunt {
    @include no-effects();
  }

  // Arrow for up positions (points down)
  &--up,
  &--up-left,
  &--up-right {
    @include arrow(down);
    bottom: 100%;
  }

  // Arrow for down positions (points up)
  &--down,
  &--down-left,
  &--down-right {
    @include arrow(up);
    top: 100%;
  }

  // Arrow for left positions (points right)
  &--left,
  &--left-top,
  &--left-bottom {
    @include arrow(right);
    right: 100%;
  }

  // Arrow for right positions (points left)
  &--right,
  &--right-top,
  &--right-bottom {
    @include arrow(left);
    left: 100%;
  }
}

.ods-tooltip-content {
  @include base-effects();
  @include normalized-text();

  align-items: flex-start;
  background: $color-interface-dark-deep;
  border-radius: $border-radius-md;
  color: $color-interface-light-pure;
  display: flex;
  font-family: $font-family-base;
  gap: $spacing-inline-xxs;
  padding: $spacing-inline-xxs-extra $spacing-inline-xs;
  position: absolute;
  white-space: pre;
  z-index: 10;

  &--visible {
    opacity: 1;
    pointer-events: auto;
  }

  &--blunt {
    @include no-effects();
  }

  &--break {
    white-space: pre-line;
    word-break: break-word;
  }

  &--small {
    white-space: normal;
    width: 80px;
  }

  &--medium {
    white-space: normal;
    width: 150px;
  }

  &--large {
    white-space: normal;
    width: 260px;
  }

  &--xlarge {
    white-space: normal;
    width: 380px;

    @media screen and (max-width: 768px) {
      width: 90vw;
    }
  }

  &--fit {
    white-space: normal;
    width: 100%;
  }

  &__text {
    flex: 1;
    line-height: 1.5;
  }

  &__close {
    align-items: center;
    background: transparent;
    border: 0;
    color: $color-interface-dark-up;
    cursor: pointer;
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    padding: 0;

    &:hover {
      color: $color-interface-light-pure;
    }
  }

  // Position: up (tooltip above, centered)
  &--up {
    bottom: 100%;
    left: 50%;
    margin-bottom: 10px;
    transform: translateX(-50%);
  }

  // Position: up-left (tooltip above, aligned left)
  &--up-left {
    bottom: 100%;
    left: 0;
    margin-bottom: 10px;
  }

  // Position: up-right (tooltip above, aligned right)
  &--up-right {
    bottom: 100%;
    margin-bottom: 10px;
    right: 0;
  }

  // Position: down (tooltip below, centered)
  &--down {
    left: 50%;
    margin-top: 10px;
    top: 100%;
    transform: translateX(-50%);
  }

  // Position: down-left (tooltip below, aligned left)
  &--down-left {
    left: 0;
    margin-top: 10px;
    top: 100%;
  }

  // Position: down-right (tooltip below, aligned right)
  &--down-right {
    margin-top: 10px;
    right: 0;
    top: 100%;
  }

  // Position: left (tooltip to left, centered vertically)
  &--left {
    margin-right: 10px;
    right: 100%;
    top: 50%;
    transform: translateY(-50%);
  }

  // Position: left-top (tooltip to left, aligned top)
  &--left-top {
    margin-right: 10px;
    right: 100%;
    top: 0;
  }

  // Position: left-bottom (tooltip to left, aligned bottom)
  &--left-bottom {
    bottom: 0;
    margin-right: 10px;
    right: 100%;
  }

  // Position: right (tooltip to right, centered vertically)
  &--right {
    left: 100%;
    margin-left: 10px;
    top: 50%;
    transform: translateY(-50%);
  }

  // Position: right-top (tooltip to right, aligned top)
  &--right-top {
    left: 100%;
    margin-left: 10px;
    top: 0;
  }

  // Position: right-bottom (tooltip to right, aligned bottom)
  &--right-bottom {
    bottom: 0;
    left: 100%;
    margin-left: 10px;
  }
}

.ods-tooltip {
  cursor: pointer;
  position: relative;
}

.ods-tooltip::after {
  @include base-effects();
  @include normalized-text();

  background: $color-interface-dark-deep;
  border-radius: $border-radius-md;
  color: $color-interface-light-pure;
  content: attr(aria-label);
  padding: $spacing-inline-xxs-extra $spacing-inline-xs;
  position: absolute;
  white-space: pre;
  z-index: 10;
}

.ods-tooltip::before {
  @include arrow(down);
  @include base-effects();

  content: '';
  position: absolute;
  z-index: 10;
}

.ods-tooltip:hover,
.ods-tooltip[data-tooltip-visible],
.ods-tooltip:not([data-tooltip-nofocus]):focus {
  &::before,
  &::after {
    opacity: 1;
    pointer-events: none;
  }
}

.ods-tooltip[data-tooltip-break] {
  &::after {
    white-space: pre;
  }

  &[data-tooltip-length] {
    &::after {
      white-space: pre-line;
      word-break: break-word;
    }
  }
}

.ods-tooltip[data-tooltip-blunt] {
  &::before,
  &::after {
    @include no-effects();
  }
}

.ods-tooltip[data-tooltip-pos='up'],
.ods-tooltip[data-tooltip-pos='down'] {
  &:hover,
  &[data-tooltip-visible] {
    &::after {
      transform: translate(-50%, 0);
    }

    &::before {
      transform: translate(-50%, 0);
    }
  }
}

.ods-tooltip[data-tooltip-pos*='-left'] {
  &::after {
    left: 0;
  }

  &::before {
    left: 8px;
  }
}

.ods-tooltip[data-tooltip-pos*='-right'] {
  &::after {
    right: 0;
  }

  &::before {
    right: 8px;
  }
}

.ods-tooltip[data-tooltip-pos*='-left'],
.ods-tooltip[data-tooltip-pos*='-right'] {
  &:hover,
  &[data-tooltip-visible] {
    &::after {
      transform: translate(0, 0);
    }

    &::before {
      transform: translate(0, 0);
    }
  }
}

.ods-tooltip[data-tooltip-pos^='up'] {
  &::before,
  &::after {
    bottom: 100%;
    transform: translate(0, 4px);
    transform-origin: top;
  }

  &::after {
    margin-bottom: 10px;
  }
}

.ods-tooltip[data-tooltip-pos='up'] {
  &::before,
  &::after {
    left: 50%;
    transform: translate(-50%, 4px);
  }
}

.ods-tooltip[data-tooltip-pos^='down'] {
  &::before,
  &::after {
    top: 100%;
    transform: translate(0, calc(4px * -1));
  }

  &::after {
    margin-top: 10px;
  }

  &::before {
    @include arrow(up);
  }
}

.ods-tooltip[data-tooltip-pos='down'] {
  &::after,
  &::before {
    left: 50%;
    transform: translate(-50%, calc(4px * -1));
  }
}

.ods-tooltip[data-tooltip-pos='left'],
.ods-tooltip[data-tooltip-pos='right'] {
  &:hover,
  &[data-tooltip-visible] {
    &::after {
      transform: translate(0, -50%);
    }

    &::before {
      transform: translate(0, -50%);
    }
  }
}

.ods-tooltip[data-tooltip-pos='left'] {
  &::after,
  &::before {
    right: 100%;
    top: 50%;
    transform: translate(4px, -50%);
  }

  &::after {
    margin-right: 10px;
  }

  &::before {
    @include arrow(right);
  }
}

.ods-tooltip[data-tooltip-pos='right'] {
  &::after,
  &::before {
    left: 100%;
    top: 50%;
    transform: translate(calc(4px * -1), -50%);
  }

  &::after {
    margin-left: 10px;
  }

  &::before {
    @include arrow(left);
  }
}

.ods-tooltip[data-tooltip-length] {
  &::after {
    white-space: normal;
  }
}

.ods-tooltip[data-tooltip-length='small'] {
  &::after {
    width: 80px;
  }
}

.ods-tooltip[data-tooltip-length='medium'] {
  &::after {
    width: 150px;
  }
}

.ods-tooltip[data-tooltip-length='large'] {
  &::after {
    width: 260px;
  }
}

.ods-tooltip[data-tooltip-length='xlarge'] {
  &::after {
    width: 380px;

    @media screen and (max-width: 768px) {
      width: 90vw;
    }
  }
}

.ods-tooltip[data-tooltip-length='fit'] {
  &::after {
    width: 100%;
  }
}

// New positions: left-top, left-bottom, right-top, right-bottom
.ods-tooltip[data-tooltip-pos='left-top'] {
  &::after,
  &::before {
    right: 100%;
    top: 0;
    transform: translate(4px, 0);
  }

  &::after {
    margin-right: 10px;
  }

  &::before {
    @include arrow(right);
    top: 12px;
  }

  &:hover,
  &[data-tooltip-visible] {
    &::after,
    &::before {
      transform: translate(0, 0);
    }
  }
}

.ods-tooltip[data-tooltip-pos='left-bottom'] {
  &::after,
  &::before {
    bottom: 0;
    right: 100%;
    transform: translate(4px, 0);
  }

  &::after {
    margin-right: 10px;
  }

  &::before {
    @include arrow(right);
    bottom: 12px;
    top: auto;
  }

  &:hover,
  &[data-tooltip-visible] {
    &::after,
    &::before {
      transform: translate(0, 0);
    }
  }
}

.ods-tooltip[data-tooltip-pos='right-top'] {
  &::after,
  &::before {
    left: 100%;
    top: 0;
    transform: translate(calc(4px * -1), 0);
  }

  &::after {
    margin-left: 10px;
  }

  &::before {
    @include arrow(left);
    top: 14px;
  }

  &:hover,
  &[data-tooltip-visible] {
    &::after,
    &::before {
      transform: translate(0, 0);
    }
  }
}

.ods-tooltip[data-tooltip-pos='right-bottom'] {
  &::after,
  &::before {
    bottom: 0;
    left: 100%;
    transform: translate(calc(4px * -1), 0);
  }

  &::after {
    margin-left: 10px;
  }

  &::before {
    @include arrow(left);
    bottom: 14px;
    top: auto;
  }

  &:hover,
  &[data-tooltip-visible] {
    &::after,
    &::before {
      transform: translate(0, 0);
    }
  }
}
