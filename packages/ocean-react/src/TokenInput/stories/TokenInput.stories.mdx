import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import TokenInput from '../TokenInput';
import { EyeOutline } from '@useblu/ocean-icons-react';

export const TOKEN_INPUT_LABELS = {
  basicLabel: 'Codigo de Verificacao',
  smsLabel: 'Codigo SMS',
  emailLabel: 'Codigo do Email',
  authLabel: 'Codigo de Autenticacao',
  securityLabel: 'Codigo de Seguranca',
  accessLabel: 'Codigo de Acesso',
  confirmationLabel: 'Codigo de Confirmacao',
  requiredField: 'Campo Obrigatorio',
};

export const TOKEN_INPUT_HELPER_TEXTS = {
  basicHelp: 'Digite o codigo recebido',
  smsHelp: 'Verifique o codigo enviado por SMS',
  emailHelp: 'Confira o codigo em seu email',
  authHelp: 'Use o codigo do seu aplicativo autenticador',
  securityHelp: 'Codigo de seguranca de 6 digitos',
  accessHelp: 'Codigo de acesso temporario',
  confirmationHelp: 'Codigo para confirmar a operacao',
  validationError: 'Codigo incorreto ou expirado',
  requiredError: 'Este campo e obrigatorio',
  formatError: 'Formato do codigo invalido',
};

export const TOKEN_INPUT_PLACEHOLDERS = {
  basicPlaceholder: '0000',
  smsPlaceholder: '123456',
  emailPlaceholder: '000000',
  authPlaceholder: '123456',
  securityPlaceholder: '000000',
  accessPlaceholder: '0000',
  confirmationPlaceholder: '123456',
};

export const TOKEN_INPUT_SCENARIOS = {
  basic: { digitsQuantity: 4, type: 'numeric' },
  sms: { digitsQuantity: 6, type: 'numeric' },
  email: { digitsQuantity: 6, type: 'numeric' },
  auth: { digitsQuantity: 6, type: 'numeric' },
  security: { digitsQuantity: 6, type: 'numeric' },
  access: { digitsQuantity: 4, type: 'numeric' },
  confirmation: { digitsQuantity: 6, type: 'numeric' },
  short: { digitsQuantity: 3, type: 'numeric' },
  long: { digitsQuantity: 8, type: 'numeric' },
};

<Meta
  title="Components/Inputs/TokenInput"
  component={TokenInput}
  decorators={[(storyFn) => <div className="input-story">{storyFn()}</div>]}
  argTypes={{
    label: {
      name: 'label',
      description: 'O rotulo do campo token input.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
    errorMessage: {
      name: 'errorMessage',
      description: 'Mensagem de erro exibida quando error e true.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
    error: {
      name: 'error',
      description: 'Quando true, aplica o estilo de erro ao campo.',
      table: {
        type: { summary: 'boolean' },
        defaultValue: { summary: false },
      },
      control: { type: 'boolean' },
    },
    disabled: {
      name: 'disabled',
      description: 'Quando true, desabilita o campo token input.',
      table: {
        type: { summary: 'boolean' },
        defaultValue: { summary: false },
      },
      control: { type: 'boolean' },
    },
    digitsQuantity: {
      name: 'digitsQuantity',
      description: 'Numero de digitos do token.',
      table: {
        type: { summary: 'number' },
        defaultValue: { summary: '4' },
      },
      control: { type: 'number' },
    },
    value: {
      name: 'value',
      description: 'O valor atual do token input.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
    onChangeToken: {
      name: 'onChangeToken',
      description: 'Funcao chamada quando o valor muda.',
      table: {
        type: { summary: 'function' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'function' },
    },
  }}
/>

# TokenInput

Componente especializado para entrada de codigos de verificacao e tokens numericos com campos individuais para cada digito.

## Visao Geral

O componente TokenInput oferece uma interface otimizada para entrada de codigos de verificacao, como tokens SMS, codigos de email, ou codigos de autenticacao. Cada digito e exibido em um campo separado, proporcionando melhor experiencia visual e de usabilidade. Suporta navegacao automatica entre campos e validacao de formato.

## Importacao

```javascript
import { TokenInput } from '@useblu/ocean-react';
```

## Uso

O componente TokenInput pode ser usado em varios contextos. Aqui estao alguns padroes comuns:

### Uso Basico

<Canvas withSource="open" withToolbar>
  <Story name="usage">
    <TokenInput
      label={TOKEN_INPUT_LABELS.basicLabel}
      digitsQuantity={TOKEN_INPUT_SCENARIOS.basic.digitsQuantity}
      errorMessage={TOKEN_INPUT_HELPER_TEXTS.basicHelp}
      onChangeToken={(value) => console.log('Token:', value)}
    />
  </Story>
</Canvas>

### Padroes Comuns

```jsx
// Exemplo basico usando variaveis
<TokenInput
  label={TOKEN_INPUT_LABELS.smsLabel}
  digitsQuantity={TOKEN_INPUT_SCENARIOS.sms.digitsQuantity}
  errorMessage={TOKEN_INPUT_HELPER_TEXTS.smsHelp}
/>

// Em formularios com validacao
<form onSubmit={handleSubmit}>
  <TokenInput
    label={TOKEN_INPUT_LABELS.requiredField}
    digitsQuantity={TOKEN_INPUT_SCENARIOS.auth.digitsQuantity}
    errorMessage={TOKEN_INPUT_HELPER_TEXTS.authHelp}
    error={false}
    required
  />
</form>
```

## Referencia da API

O componente TokenInput e baseado em multiplos elementos `input` e suporta atributos customizados.

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Tipo</th>
      <th>Padrao</th>
      <th>Descricao</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>label</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        O rotulo do campo token input. Exibido acima dos campos para
        identificacao.
      </td>
    </tr>
    <tr>
      <td>errorMessage</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        Mensagem de erro exibida quando error e true. Substitui o helperText em
        caso de erro.
      </td>
    </tr>
    <tr>
      <td>error</td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        Quando true, aplica o estilo de erro aos campos. Use para indicar
        problemas de validacao.
      </td>
    </tr>
    <tr>
      <td>disabled</td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        Quando true, desabilita todos os campos do token input. Use quando a
        entrada nao e permitida.
      </td>
    </tr>
    <tr>
      <td>digitsQuantity</td>
      <td>
        <code>number</code>
      </td>
      <td>
        <code>4</code>
      </td>
      <td>
        Numero de digitos do token. Define quantos campos individuais serao
        exibidos.
      </td>
    </tr>
    <tr>
      <td>value</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        O valor atual do token input. Use para controlar o estado do componente.
      </td>
    </tr>
    <tr>
      <td>onChangeToken</td>
      <td>
        <code>function</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        Funcao chamada quando o valor muda. Recebe o valor completo do token
        como parametro.
      </td>
    </tr>
  </tbody>
</table>

## Exemplos

### Diferentes Quantidades de Digitos

Demonstracao com diferentes configuracoes de numero de digitos:

<Canvas withSource="open" withToolbar>
  <Story name="different-digits">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <TokenInput
        label="Codigo Curto (3 digitos)"
        digitsQuantity={TOKEN_INPUT_SCENARIOS.short.digitsQuantity}
        errorMessage="Para codigos rapidos"
        onChangeToken={(value) => console.log('Token 3 digitos:', value)}
      />
      <TokenInput
        label={TOKEN_INPUT_LABELS.basicLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.basic.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.basicHelp}
        onChangeToken={(value) => console.log('Token basico:', value)}
      />
      <TokenInput
        label={TOKEN_INPUT_LABELS.smsLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.sms.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.smsHelp}
        onChangeToken={(value) => console.log('Token SMS:', value)}
      />
      <TokenInput
        label="Codigo Longo (8 digitos)"
        digitsQuantity={TOKEN_INPUT_SCENARIOS.long.digitsQuantity}
        errorMessage="Para codigos estendidos"
        onChangeToken={(value) => console.log('Token 8 digitos:', value)}
      />
    </div>
  </Story>
</Canvas>

### Estados de Erro

Use a prop `error` para indicar problemas de validacao:

<Canvas withSource="open" withToolbar>
  <Story name="error-states">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <TokenInput
        label={TOKEN_INPUT_LABELS.requiredField}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.auth.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.validationError}
        error={true}
        onChangeToken={(value) => console.log('Token com erro:', value)}
      />
      <TokenInput
        label={TOKEN_INPUT_LABELS.authLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.auth.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.authHelp}
        error={false}
        onChangeToken={(value) => console.log('Token normal:', value)}
      />
    </div>
  </Story>
</Canvas>

### Estados Desabilitados

Use a prop `disabled` quando a entrada nao e permitida:

<Canvas withSource="open" withToolbar>
  <Story name="disabled-states">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <TokenInput
        label={TOKEN_INPUT_LABELS.securityLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.security.digitsQuantity}
        errorMessage="Campo desabilitado"
        disabled={true}
        onChangeToken={(value) => console.log('Token desabilitado:', value)}
      />
      <TokenInput
        label={TOKEN_INPUT_LABELS.accessLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.access.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.accessHelp}
        disabled={false}
        onChangeToken={(value) => console.log('Token habilitado:', value)}
      />
    </div>
  </Story>
</Canvas>

### Cenarios de Uso Comuns

Exemplos de diferentes tipos de verificacao:

<Canvas withSource="open" withToolbar>
  <Story name="common-scenarios">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <TokenInput
        label={TOKEN_INPUT_LABELS.smsLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.sms.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.smsHelp}
        onChangeToken={(value) => console.log('Token SMS:', value)}
      />
      <TokenInput
        label={TOKEN_INPUT_LABELS.emailLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.email.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.emailHelp}
        onChangeToken={(value) => console.log('Token Email:', value)}
      />
      <TokenInput
        label={TOKEN_INPUT_LABELS.confirmationLabel}
        digitsQuantity={TOKEN_INPUT_SCENARIOS.confirmation.digitsQuantity}
        errorMessage={TOKEN_INPUT_HELPER_TEXTS.confirmationHelp}
        onChangeToken={(value) => console.log('Token Confirmacao:', value)}
      />
    </div>
  </Story>
</Canvas>

## Integracao com Formularios

### Uso em Formularios

```jsx
<form onSubmit={handleSubmit}>
  <TokenInput
    label={TOKEN_INPUT_LABELS.smsLabel}
    digitsQuantity={TOKEN_INPUT_SCENARIOS.sms.digitsQuantity}
    name="verificationCode"
    onChangeToken={handleTokenChange}
  />
  <Button type="submit">Verificar</Button>
</form>
```

### Validacao

```jsx
<form onSubmit={handleSubmit}>
  <TokenInput
    label={TOKEN_INPUT_LABELS.requiredField}
    digitsQuantity={TOKEN_INPUT_SCENARIOS.auth.digitsQuantity}
    errorMessage={TOKEN_INPUT_HELPER_TEXTS.validationError}
    error={hasError}
    onChangeToken={handleTokenChange}
    required
  />
  <Button type="submit" disabled={!isTokenValid}>
    Confirmar
  </Button>
</form>
```

### Controle de Estado

```jsx
function VerificationForm() {
  const [token, setToken] = useState('');
  const [isValid, setIsValid] = useState(false);
  const [error, setError] = useState(false);

  const handleTokenChange = (value) => {
    setToken(value);
    setIsValid(value.length === 6);
    setError(false);
  };

  const handleSubmit = async () => {
    try {
      await verifyToken(token);
    } catch (err) {
      setError(true);
    }
  };

  return (
    <div>
      <TokenInput
        label={TOKEN_INPUT_LABELS.authLabel}
        digitsQuantity={6}
        value={token}
        onChangeToken={handleTokenChange}
        error={error}
        errorMessage={
          error
            ? TOKEN_INPUT_HELPER_TEXTS.validationError
            : TOKEN_INPUT_HELPER_TEXTS.authHelp
        }
      />
      <Button onClick={handleSubmit} disabled={!isValid}>
        Verificar Codigo
      </Button>
    </div>
  );
}
```

## Classes CSS

<table>
  <thead>
    <tr>
      <th>Classe Global</th>
      <th>Descricao</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>.ods-token-input</code>
      </td>
      <td>Estilos aplicados ao container principal do componente.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-token-input__input</code>
      </td>
      <td>Estilos aplicados a cada campo individual de digito.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-token-input--error</code>
      </td>
      <td>Estilos aplicados ao componente quando error={true}.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-token-input--disabled</code>
      </td>
      <td>Estilos aplicados ao componente quando disabled={true}.</td>
    </tr>
  </tbody>
</table>

## Melhores Praticas

### 1. Uso Geral

- Use para codigos de verificacao e tokens numericos
- Defina o numero correto de digitos conforme o tipo de codigo
- Forneca labels claros que indiquem o tipo de verificacao
- Use mensagens de erro especificas para cada cenario

### 2. Quantidade de Digitos

- SMS: geralmente 6 digitos
- Email: 4-6 digitos
- Autenticacao 2FA: 6 digitos
- Codigos de acesso: 4-8 digitos
- Considere o padrao do seu sistema

### 3. Validacao e Feedback

- Valide o formato em tempo real
- Forneca feedback claro sobre erros
- Use mensagens especificas para cada tipo de erro
- Considere timeout para codigos temporarios

### 4. Acessibilidade

- Sempre use labels apropriados
- Mantenha navegacao por teclado funcional
- Use aria-labels para contexto adicional
- Forneca instrucoes claras sobre o codigo esperado

### 5. UX e Usabilidade

- Navegacao automatica entre campos
- Suporte a colagem de codigos completos
- Feedback visual para campos preenchidos
- Opcao de reenvio de codigo quando apropriado
- Considere auto-submit quando todos os digitos forem preenchidos

### 6. Seguranca

- Nao armazene tokens em localStorage
- Implemente timeout adequado
- Use HTTPS para transmissao
- Considere rate limiting para tentativas

## Props

<ArgsTable of={TokenInput} />

Qualquer outra prop fornecida sera passada para o elemento raiz.

## Playground

<Canvas>
  <Story
    name="playground"
    args={{
      label: TOKEN_INPUT_LABELS.basicLabel,
      errorMessage: TOKEN_INPUT_HELPER_TEXTS.basicHelp,
      error: false,
      disabled: false,
      digitsQuantity: TOKEN_INPUT_SCENARIOS.basic.digitsQuantity,
    }}
    argTypes={{
      label: {
        control: { type: 'text' },
      },
      disabled: {
        control: { type: 'boolean' },
      },
      errorMessage: {
        control: { type: 'text' },
      },
      digitsQuantity: {
        control: { type: 'number' },
      },
    }}
  >
    {(props) => (
      <TokenInput
        {...props}
        onChangeToken={(value) => console.log('Playground Token:', value)}
      />
    )}
  </Story>
</Canvas>

## Heranca

As props do componente [FormControl](?path=/docs/components-formcontrol--page) tambem estao disponiveis.
