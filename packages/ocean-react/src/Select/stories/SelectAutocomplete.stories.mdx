import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';
import SelectAutocomplete from '../SelectAutocomplete';

export const SELECT_AUTOCOMPLETE_LABELS = {
  basicLabel: 'Pesquisar e selecionar',
  searchLabel: 'Buscar opção',
  countryLabel: 'País',
  cityLabel: 'Cidade',
  productLabel: 'Produto',
  userLabel: 'Usuário',
  requiredField: 'Campo Obrigatório',
};

export const SELECT_AUTOCOMPLETE_HELPER_TEXTS = {
  basicHelp: 'Digite para buscar e selecionar uma opção',
  searchHelp: 'Use o campo para pesquisar entre as opções disponíveis',
  countryHelp: 'Digite o nome do país para buscar',
  cityHelp: 'Pesquise a cidade desejada',
  productHelp: 'Digite o nome do produto para encontrar',
  userHelp: 'Busque pelo nome do usuário',
  validationError: 'Este campo é obrigatório',
  noResultsHelp: 'Nenhum resultado encontrado para sua busca',
};

export const SELECT_AUTOCOMPLETE_PLACEHOLDERS = {
  basicPlaceholder: 'Digite para buscar...',
  searchPlaceholder: 'Pesquisar...',
  countryPlaceholder: 'Digite o nome do país',
  cityPlaceholder: 'Digite o nome da cidade',
  productPlaceholder: 'Digite o nome do produto',
  userPlaceholder: 'Digite o nome do usuário',
};

export const SELECT_AUTOCOMPLETE_OPTIONS = {
  countries: [
    { value: 'br', label: 'Brasil' },
    { value: 'us', label: 'Estados Unidos' },
    { value: 'ca', label: 'Canadá' },
    { value: 'mx', label: 'México' },
    { value: 'ar', label: 'Argentina' },
    { value: 'cl', label: 'Chile' },
    { value: 'co', label: 'Colômbia' },
    { value: 'pe', label: 'Peru' },
  ],
  cities: [
    { value: 'sp', label: 'São Paulo' },
    { value: 'rj', label: 'Rio de Janeiro' },
    { value: 'bh', label: 'Belo Horizonte' },
    { value: 'salvador', label: 'Salvador' },
    { value: 'brasilia', label: 'Brasília' },
    { value: 'fortaleza', label: 'Fortaleza' },
  ],
  products: [
    { value: 'laptop', label: 'Laptop' },
    { value: 'smartphone', label: 'Smartphone' },
    { value: 'tablet', label: 'Tablet' },
    { value: 'monitor', label: 'Monitor' },
    { value: 'keyboard', label: 'Teclado' },
    { value: 'mouse', label: 'Mouse' },
  ],
  users: [
    { value: 'john', label: 'João Silva' },
    { value: 'mary', label: 'Maria Santos' },
    { value: 'peter', label: 'Pedro Oliveira' },
    { value: 'ana', label: 'Ana Costa', disabled: true },
    { value: 'carlos', label: 'Carlos Ferreira' },
  ],
};

<Meta
  title="Components/Inputs/SelectAutocomplete"
  component={SelectAutocomplete}
  decorators={[(storyFn) => <div className="input-story">{storyFn()}</div>]}
  argTypes={{
    label: {
      name: 'label',
      description: 'O rótulo do campo select autocomplete.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
    placeholder: {
      name: 'placeholder',
      description: 'Texto exibido quando nenhuma opção está selecionada.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
    helperText: {
      name: 'helperText',
      description: 'Texto de ajuda exibido abaixo do campo.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
    error: {
      name: 'error',
      description: 'Quando true, aplica o estilo de erro ao campo.',
      table: {
        type: { summary: 'boolean' },
        defaultValue: { summary: false },
      },
      control: { type: 'boolean' },
    },
    disabled: {
      name: 'disabled',
      description: 'Quando true, desabilita o campo select autocomplete.',
      table: {
        type: { summary: 'boolean' },
        defaultValue: { summary: false },
      },
      control: { type: 'boolean' },
    },
    options: {
      name: 'options',
      description: 'Array de opções disponíveis para busca e seleção.',
      table: {
        type: { summary: 'Array' },
        defaultValue: { summary: '[]' },
      },
      control: { type: 'object' },
    },
    value: {
      name: 'value',
      description: 'O valor atualmente selecionado.',
      table: {
        type: { summary: 'string' },
        defaultValue: { summary: 'undefined' },
      },
      control: { type: 'text' },
    },
  }}
/>

# SelectAutocomplete

Componente de seleção com funcionalidade de busca automática que permite filtrar opções em tempo real.

## Visão Geral

O componente SelectAutocomplete combina a funcionalidade de um campo de busca com um select, permitindo que usuários digitem para filtrar opções disponíveis. Ideal para listas grandes onde a busca melhora significativamente a experiência do usuário.

## Importação

```javascript
import { SelectAutocomplete } from '@useblu/ocean-react';
```

## Uso

O componente SelectAutocomplete pode ser usado em vários contextos. Aqui estão alguns padrões comuns:

### Uso Básico

<Canvas withSource="open" withToolbar>
  <Story name="usage">
    <SelectAutocomplete
      label={SELECT_AUTOCOMPLETE_LABELS.basicLabel}
      placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.basicPlaceholder}
      helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.basicHelp}
      options={SELECT_AUTOCOMPLETE_OPTIONS.countries}
    />
  </Story>
</Canvas>

### Padrões Comuns

```jsx
// Exemplo básico usando variáveis
<SelectAutocomplete
  label={SELECT_AUTOCOMPLETE_LABELS.countryLabel}
  placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.countryPlaceholder}
  helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.countryHelp}
  options={SELECT_AUTOCOMPLETE_OPTIONS.countries}
/>

// Em formulários com validação
<form onSubmit={handleSubmit}>
  <SelectAutocomplete
    label={SELECT_AUTOCOMPLETE_LABELS.requiredField}
    placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.userPlaceholder}
    helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.userHelp}
    error={false}
    options={SELECT_AUTOCOMPLETE_OPTIONS.users}
    required
  />
</form>
```

## Referência da API

O componente SelectAutocomplete é baseado no elemento `input` com funcionalidade de autocomplete e suporta todos os atributos padrão.

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Tipo</th>
      <th>Padrão</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>label</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        O rótulo do campo select autocomplete. Exibido acima do campo para
        identificação.
      </td>
    </tr>
    <tr>
      <td>placeholder</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        Texto exibido quando nenhuma opção está selecionada. Orienta sobre a
        funcionalidade de busca.
      </td>
    </tr>
    <tr>
      <td>helperText</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        Texto de ajuda exibido abaixo do campo. Use para instruções de busca ou
        validação.
      </td>
    </tr>
    <tr>
      <td>error</td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        Quando true, aplica o estilo de erro ao campo. Use para indicar
        problemas de validação.
      </td>
    </tr>
    <tr>
      <td>disabled</td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>
        Quando true, desabilita o campo select autocomplete. Use quando a busca
        não é permitida.
      </td>
    </tr>
    <tr>
      <td>options</td>
      <td>
        <code>Array</code>
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        Array de opções disponíveis para busca e seleção. Cada opção deve ter
        value e label.
      </td>
    </tr>
    <tr>
      <td>value</td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>
        O valor atualmente selecionado. Use para controlar o estado do
        componente.
      </td>
    </tr>
  </tbody>
</table>

## Exemplos

### Busca em Diferentes Tipos de Dados

Demonstração com diferentes conjuntos de opções:

<Canvas withSource="open" withToolbar>
  <Story name="different-data-types">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.countryLabel}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.countryPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.countryHelp}
        options={SELECT_AUTOCOMPLETE_OPTIONS.countries}
      />
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.cityLabel}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.cityPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.cityHelp}
        options={SELECT_AUTOCOMPLETE_OPTIONS.cities}
      />
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.productLabel}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.productPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.productHelp}
        options={SELECT_AUTOCOMPLETE_OPTIONS.products}
      />
    </div>
  </Story>
</Canvas>

### Estados de Erro

Use a prop `error` para indicar problemas de validação:

<Canvas withSource="open" withToolbar>
  <Story name="error-states">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.requiredField}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.userPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.validationError}
        error={true}
        options={SELECT_AUTOCOMPLETE_OPTIONS.users}
      />
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.userLabel}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.userPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.userHelp}
        error={false}
        options={SELECT_AUTOCOMPLETE_OPTIONS.users}
      />
    </div>
  </Story>
</Canvas>

### Estados Desabilitados

Use a prop `disabled` quando a busca não é permitida:

<Canvas withSource="open" withToolbar>
  <Story name="disabled-states">
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.productLabel}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.productPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.productHelp}
        disabled={true}
        options={SELECT_AUTOCOMPLETE_OPTIONS.products}
      />
      <SelectAutocomplete
        label={SELECT_AUTOCOMPLETE_LABELS.cityLabel}
        placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.cityPlaceholder}
        helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.cityHelp}
        disabled={false}
        options={SELECT_AUTOCOMPLETE_OPTIONS.cities}
      />
    </div>
  </Story>
</Canvas>

### Opções com Estados Desabilitados

Demonstração de opções individuais desabilitadas:

<Canvas withSource="open" withToolbar>
  <Story name="disabled-options">
    <SelectAutocomplete
      label={SELECT_AUTOCOMPLETE_LABELS.userLabel}
      placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.userPlaceholder}
      helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.userHelp}
      options={SELECT_AUTOCOMPLETE_OPTIONS.users}
    />
  </Story>
</Canvas>

## Integração com Formulários

### Uso em Formulários

```jsx
<form onSubmit={handleSubmit}>
  <SelectAutocomplete
    label={SELECT_AUTOCOMPLETE_LABELS.userLabel}
    placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.userPlaceholder}
    name="user"
    options={SELECT_AUTOCOMPLETE_OPTIONS.users}
  />
  <Button type="submit">Enviar</Button>
</form>
```

### Validação

```jsx
<form onSubmit={handleSubmit}>
  <SelectAutocomplete
    label={SELECT_AUTOCOMPLETE_LABELS.requiredField}
    placeholder={SELECT_AUTOCOMPLETE_PLACEHOLDERS.countryPlaceholder}
    helperText={SELECT_AUTOCOMPLETE_HELPER_TEXTS.countryHelp}
    error={false}
    options={SELECT_AUTOCOMPLETE_OPTIONS.countries}
    required
  />
  <Button type="submit" disabled={false}>
    Criar
  </Button>
</form>
```

## Classes CSS

<table>
  <thead>
    <tr>
      <th>Classe Global</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>.ods-select-autocomplete__root</code>
      </td>
      <td>Estilos aplicados ao elemento raiz.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-select-autocomplete__arrow</code>
      </td>
      <td>Estilos aplicados ao elemento de seta.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-select-autocomplete__arrow--up</code>
      </td>
      <td>Estilos aplicados à seta quando o popup está aberto.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-select-autocomplete__arrow--down</code>
      </td>
      <td>Estilos aplicados à seta quando o popup está fechado.</td>
    </tr>
    <tr>
      <td>
        <code>.ods-select-autocomplete__arrow--disabled</code>
      </td>
      <td>Estilos aplicados à seta quando disabled={true}.</td>
    </tr>
  </tbody>
</table>

## Melhores Práticas

### 1. Uso Geral

- Use labels descritivos que indiquem a funcionalidade de busca
- Forneça placeholders que orientem sobre o que pode ser digitado
- Mantenha listas de opções organizadas alfabeticamente quando possível
- Use helperText para explicar como a busca funciona

### 2. Performance

- Para listas muito grandes, considere implementar busca do lado do servidor
- Use debounce para evitar muitas chamadas de busca
- Limite o número de resultados exibidos simultaneamente

### 3. Busca e Filtros

- Implemente busca que funcione com acentos e caracteres especiais
- Considere busca por múltiplos campos (value e label)
- Forneça feedback quando nenhum resultado é encontrado
- Mantenha a busca case-insensitive

### 4. Acessibilidade

- Sempre use labels apropriados
- Forneça helperText descritivo sobre a funcionalidade
- Mantenha navegação por teclado funcional
- Use aria-labels adequados para leitores de tela

### 5. Design e UX

- Destaque os termos de busca nos resultados quando possível
- Use loading states durante buscas assíncronas
- Mantenha feedback visual claro sobre o estado da busca
- Considere mostrar quantos resultados foram encontrados

## Props

<ArgsTable of={SelectAutocomplete} />

A ref é encaminhada para o elemento raiz. Qualquer outra prop fornecida será passada para o elemento raiz.

## Playground

<Canvas>
  <Story
    name="playground"
    args={{
      label: SELECT_AUTOCOMPLETE_LABELS.basicLabel,
      placeholder: SELECT_AUTOCOMPLETE_PLACEHOLDERS.basicPlaceholder,
      helperText: SELECT_AUTOCOMPLETE_HELPER_TEXTS.basicHelp,
      error: false,
      disabled: false,
      options: SELECT_AUTOCOMPLETE_OPTIONS.countries,
    }}
  >
    {(args) => <SelectAutocomplete {...args} />}
  </Story>
</Canvas>

## Herança

As props do componente [FormControl](?path=/docs/components-formcontrol--page) também estão disponíveis.

Se isso não for suficiente, você pode verificar a [implementação do componente](https://github.com/ocean-ds/ocean-web/blob/master/packages/ocean-react/src/Select/SelectAutocomplete.tsx) para mais detalhes.
